local Library = loadstring(Game:HttpGet("https://raw.githubusercontent.com/bloodball/-back-ups-for-libs/main/wizard"))()

local MainWindow = Library:NewWindow("Combat")

local MainSection = MainWindow:NewSection("Main")

getgenv().AutoFarm = false
getgenv().KeyAutoFarm = false
-- Get the player and the character
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

local storages = workspace.Storages

local function StorageAutoFarm()
    while AutoFarm == true do
        for _, storage in pairs(storages:GetChildren()) do
            if AutoFarm == false then break
                if storage:IsA("Model") then
                    local handle = storage.Door:FindFirstChild("Handle")
                    if handle then
                        print("found handle")
                        character.HumanoidRootPart.CFrame = handle.CFrame
                        print("teleporting to handle")
                        local prompt = handle:FindFirstChildWhichIsA("ProximityPrompt")
                        if prompt then
                        task.wait(0.5)
                        fireproximityprompt(prompt)
                        task.wait(1)
                            local contents = storage:FindFirstChild("Contents")
                            if contents then
                                local loot = contents:FindFirstChild("Loot")
                                if loot then
                                    for _, item in pairs(loot:GetDescendants()) do
                                        if item:IsA("ProximityPrompt") then
                                            if item.Parent:IsA("Part") or item.Parent:IsA("MeshPart") then
                                                character.HumanoidRootPart.CFrame = item.Parent.CFrame
                                                local Itemprompt = item
                                                if Itemprompt then
                                                wait(0.1)
                                                fireproximityprompt(Itemprompt)
                                                wait(0.2)
                                                end
                                            elseif item.Parent:IsA("Model") then
                                                character.HumanoidRootPart.CFrame = item.Parent.PrimaryPart.CFrame
                                                local Itemprompt = item
                                                if prompt then
                                                    wait(0.1)
                                                    fireproximityprompt(Itemprompt)
                                                    wait(0.2)
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
        wait()
    end
end

local function KeyStorageAutoFarm()
    while KeyAutoFarm == true do
        for _, storage in pairs(storages:GetChildren()) do
            if KeyAutoFarm == false then break
                if storage:IsA("Model") then
                    if storage.Door.Lock then
                        local handle = storage.Door:FindFirstChild("Handle")
                        if handle then
                            print("found handle")
                            character.HumanoidRootPart.CFrame = handle.CFrame
                            print("teleporting to handle")
                            local prompt = handle:FindFirstChildWhichIsA("ProximityPrompt")
                            if prompt then
                            task.wait(0.5)
                            fireproximityprompt(prompt)
                            task.wait(1)
                                local contents = storage:FindFirstChild("Contents")
                                if contents then
                                    local loot = contents:FindFirstChild("Loot")
                                    if loot then
                                        for _, item in pairs(loot:GetDescendants()) do
                                            if item:IsA("ProximityPrompt") then
                                                if item.Parent:IsA("Part") or item.Parent:IsA("MeshPart") then
                                                    character.HumanoidRootPart.CFrame = item.Parent.CFrame
                                                    local Itemprompt = item
                                                    if Itemprompt then
                                                    wait(0.1)
                                                    fireproximityprompt(Itemprompt)
                                                    wait(0.2)
                                                    end
                                                elseif item.Parent:IsA("Model") then
                                                    character.HumanoidRootPart.CFrame = item.Parent.PrimaryPart.CFrame
                                                    local Itemprompt = item
                                                    if prompt then
                                                        wait(0.1)
                                                        fireproximityprompt(Itemprompt)
                                                        wait(0.2)
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
        wait()
    end
end


MainSection:CreateToggle("AutoFarm", function(value)
    AutoFarm = value
    StorageAutoFarm()
end)

MainSection:CreateToggle("KeyAutoFarm", function(value)
    KeyAutoFarm = value
    KeyStorageAutoFarm()
end)

MainSection:CreateButton("Debug", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/L3monnn/RobloxScripts/Games/TheStorage"))()
end)
